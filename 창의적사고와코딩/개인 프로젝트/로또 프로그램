import urllib.request
from bs4 import BeautifulSoup
import random

NormalNums = []
BonusNum = None

def NumMachine():    #로또 번호 생성 함수
    global NormalNums  #일반 로또 번호
    global BonusNum      #보너스 번호
    Number = list(range(1, 46))
    NormalNums = []  #빈 리스트 생성
    while len(NormalNums)<6:   #리스트에 숫자 6개 생성될 때 까지
        Numbers= random.choice(Number) #1~45에서 난수 생성
        NormalNums.append(Numbers)  #생성된 난수를 리스트에 추가
        Number.remove(Numbers) #리스트에 추가된 숫자는 1~45에서 제거 -> 중복방지
    BonusNum  = random.randint(1, 45)
    return NormalNums, BonusNum

def Lottodata(put_turn):   #사이트에서 put_turn회차의 추첨일, 당첨번호 가져오는 함수
     # 로또 이번주 당첨 번호 사이트 주소
    url ="https://dhlottery.co.kr/gameResult.do?method=byWin&drwNo="  +put_turn
    response = urllib.request.urlopen(url) #url http
    soup = BeautifulSoup(response, "html.parser")  #html 데이터 파싱

    # 회차 
    turn = soup.select('div.win_result > h4 > strong')
    # 추첨일
    date = soup.select('div.win_result > p')
    # 당첨 번호
    nums_win = soup.select('div.num.win > p > span')
    # 보너스 번호
    nums_bonus = soup.select('div.num.bonus > p > span')

    turn2 = turn[0].text.strip()       #텍스트 정보만 추출, strip() ->공백제거                                                                          
    date2 = date[0].text.strip()
    nums_win2 = [int(num.text.strip()) for num in nums_win] #리스트로 저장
    nums_bonus2 = [int(bonus.text.strip()) for bonus in nums_bonus]
    #https://auto-trading.tistory.com/entry/특강-웹크롤링Web-Crowling-기초-기념과-코드-구현with-Python [  turn2 = turn[0].text.strip()부터 nums_bonus2 =... 까지]

    return put_turn,  turn2, date2, nums_win2, nums_bonus2

#당첨번호와 내번호 비교  함수 compare
def compare(My_numbers, My_bonus, nums_win2, nums_bonus2):
    correct_num= set(My_numbers) & set(nums_win2)      # set() : 리스트안의 숫자가 순서에 상관없이 비교할 수 있게 한다.
                                                                                                          # My_numsbers와 nums_win2 에서 같은 수 찾기
    count = len(correct_num)                                                      # 같은 수 개수
    if count == 6 :
        print('축하합니다 인생역전 성공! 1등')
    elif count == 5 :
        if My_bonus == nums_bonus2: 
            print('축하합니다 2등!')
        else :
            print('축하합니다 3등!')
    elif count == 4:
        print('축하합니다 4등!')
    elif count == 3:
        print('축하합니다 5등!')
    else :
        print('축하합니다 인생여전 성공! 꽝')

# 메인 프로그램
def run_program():
    put_turn = input('회차를 입력하세요: ')
    put_turn,  turn2, date2, nums_win2, nums_bonus2 = Lottodata(put_turn)
    print(turn2)
    print(date2)
    print(nums_win2, end=' , ')
    print(nums_bonus2)

    Numtype = input('직접 번호를 입력해 당첨번호와 대조 하시겠습니까? 생성한 번호와 하시겠습니까? "번호입력" 혹은 "생성번호" 입력 : ')
    if Numtype == '번호입력':
        My_numbers = list(map(int, input('번호 6개를 입력하세요 :').split())) #리스트 형태로 저장, map-정수변환, split-문자열 분리
        My_bonus = int(input('보너스 번호 입력:'))
    else :
        NumMachine()
        print(NormalNums, end=' , ')
        print(f'{BonusNum}')
        My_numbers, My_bonus = NumMachine()

    compare(My_numbers, My_bonus , nums_win2, nums_bonus2)

run_program()


    

